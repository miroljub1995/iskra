using Iskra.WebIDLGenerator.Models;

namespace Iskra.WebIDLGenerator.Generators;

public class CallbackTypeGenerator(
    GenSettings genSettings,
    IDLTypeDescriptionToTypeDeclarationGenerator descriptionToTypeDeclarationGenerator,
    ArgumentsToDeclarationGenerator argumentsToDeclarationGenerator
)
{
    public string Generate(CallbackType input)
    {
        var returnType = descriptionToTypeDeclarationGenerator.Generate(input.IdlType);
        var args = argumentsToDeclarationGenerator.Generate(input.Arguments);

        var content = $$"""
                        // <auto-generated/>

                        using System.Runtime.InteropServices.JavaScript;

                        namespace {{genSettings.Namespace}};

                        #nullable enable

                        public delegate {{returnType}} {{input.Name}}({{args}});

                        #nullable disable
                        """;

        return content;
    }
}