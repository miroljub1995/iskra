using Iskra.WebIDLGenerator.Extensions;
using Iskra.WebIDLGenerator.Models;

namespace Iskra.WebIDLGenerator.Generators;

public class CallbackInterfaceTypeGenerator(
    GenSettings genSettings,
    MemberTypeGenerator memberTypeGenerator
)
{
    public string Generate(CallbackInterfaceType input)
    {
        List<string> bodyParts = [];

        foreach (var idlInterfaceMemberType in input.Members)
        {
            var part = memberTypeGenerator.Generate(idlInterfaceMemberType, input.Name);
            if (!string.IsNullOrEmpty(part))
            {
                bodyParts.Add(part);
            }
        }

        var body = string.Join("\n\n", bodyParts);

        var content = $$"""
                        // <auto-generated/>

                        namespace {{genSettings.Namespace}};

                        #nullable enable

                        public partial class {{input.Name}}(global::System.Runtime.InteropServices.JavaScript.JSObject obj): global::Iskra.JSCore.JSObjectProxy(obj)
                        {
                        {{body.IndentLines(4)}}
                        }

                        #nullable disable
                        """;

        return content;
    }
}